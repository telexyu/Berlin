<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calcolo Distanza Berlino con Itinerario</title>

  <!-- Leaflet + Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

    header {
      background: rgba(0, 0, 0, 0.7);  /* Cambiato il background a 0.7 per opacit√† */
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      height: 70px;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1200px;
      padding: 0 20px;
    }

    .logo h1 {
      color: #ffd700;
      font-size: 1.8rem;
      margin: 0;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-size: 1rem;
      padding: 6px 12px;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    nav ul li a:hover {
      background-color: #ff6600;
    }

    #map {
      position: absolute;
      top: 70px;
      bottom: 0;
      width: 100%;
      z-index: 0;
    }

    .controls {
      position: fixed;
      top: 80px;
      left: 10px;
      z-index: 1001;
      background-color: white;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .controls button {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <header>
    <div class="navbar">
      <div class="logo">
        <h1><a href="https://telexyu.github.io/Berlin/" style="text-decoration: none; color: #ffd700;">Viaggio Berlino</a></h1>
      </div>
      <nav>
        <ul>
          <li><a href="https://telexyu.github.io/Berlin/itinerariopage1.html">Itinerario</a></li>
          <li><a href="https://telexyu.github.io/Berlin/berlino_luoghi.html">Luoghi</a></li>
          <li><a href="https://telexyu.github.io/Berlin/mappaberlino.html">Maps</a></li>
          <li><a href="https://telexyu.github.io/Berlin/aboutUs.html">About Us</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Mappa -->
  <div id="map"></div>

  <!-- Controlli -->
  <div class="controls">
    <p id="info">Clicca sulla mappa per selezionare due punti e calcolare la distanza.</p>
    <p id="distance"></p>
    <button id="reset" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Reset</button>
  </div>

  <!-- Script Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  <script>
    let map = L.map('map', {
      center: [52.52, 13.405],
      zoom: 13,
      layers: []
    });

    const baseLayerNormal = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    });

    const baseLayerSatellite = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3'],
      attribution: '¬© Google'
    });

    baseLayerNormal.addTo(map);

    const baseLayers = {
      "Mappa": baseLayerNormal,
      "Satellite": baseLayerSatellite
    };

    L.control.layers(baseLayers).addTo(map);

    let points = [];
    let routingControl = null;
    let markerLayer = L.layerGroup().addTo(map);

    const attrazioni = [
      {
        nome: "Porta di Brandeburgo",
        coord: [52.5163, 13.3777],
        descrizione: "Simbolo iconico della citt√†."
      },
      {
        nome: "Reichstag",
        coord: [52.5186, 13.3762],
        descrizione: "Sede del Parlamento tedesco."
      },
      {
        nome: "Isola dei Musei",
        coord: [52.5169, 13.4010],
        descrizione: "Patrimonio UNESCO, con musei famosi."
      },
      {
        nome: "East Side Gallery",
        coord: [52.5050, 13.4396],
        descrizione: "Tratto del Muro di Berlino dipinto da artisti."
      }
    ];

    const iconaAttrazione = L.icon({
      iconUrl: 'https://maps.gstatic.com/mapfiles/ms2/micons/red-pushpin.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    attrazioni.forEach(attr => {
      const marker = L.marker(attr.coord, {
        icon: iconaAttrazione
      }).addTo(markerLayer);
      marker.bindPopup(`<b>${attr.nome}</b><br>${attr.descrizione}`);
    });

    map.on('click', function (e) {
      if (points.length < 2) {
        points.push(e.latlng);
        L.marker(e.latlng).addTo(markerLayer);
        if (points.length === 2) {
          if (routingControl) {
            map.removeControl(routingControl);
          }

          routingControl = L.Routing.control({
            waypoints: points,
            routeWhileDragging: false,
            language: 'it',
            createMarker: () => null
          }).addTo(map);

          let latlng1 = points[0];
          let latlng2 = points[1];
          let distance = map.distance(latlng1, latlng2) / 1000;

          let tempoAuto = distance / 50 * 60;
          let tempoPiedi = distance / 5 * 60;
          let tempoBici = distance / 15 * 60;

          document.getElementById("distance").innerHTML =
            `Distanza lineare: ${distance.toFixed(2)} km<br>
            üö∂‚Äç‚ôÇÔ∏è Tempo a piedi: ${Math.round(tempoPiedi)} minuti<br>
            üöó Tempo in auto: ${Math.round(tempoAuto)} minuti<br>
            üö¥‚Äç‚ôÄÔ∏è Tempo in bici: ${Math.round(tempoBici)} minuti`;
        }
      }
    });

    document.getElementById("reset").addEventListener("click", () => {
      points = [];
      markerLayer.clearLayers();
      attrazioni.forEach(attr => {
        const marker = L.marker(attr.coord, {
          icon: iconaAttrazione
        }).addTo(markerLayer);
        marker.bindPopup(`<b>${attr.nome}</b><br>${attr.descrizione}`);
      });
      if (routingControl) {
        map.removeControl(routingControl);
      }
      document.getElementById("distance").innerText = "";
    });
  </script>

</body>
</html>
